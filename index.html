<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>PokeRogue Save Converter</title>
        <meta name="robots" content="index, follow" />
        <meta name="author" content="Your Name" />
        <meta
            name="description"
            content="A simple online AES encryption/decryption tool."
        />
        <meta
            name="keywords"
            content="cryptography, encryption, decryption, AES, AES 256, Rijndael"
        />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, minimum-scale=1.0"
        />
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap");

            :root {
                --bg-color: #fdfdfd;
                --surface-1: #f0d6d6;
                --primary: #ff2058;
                --secondary: #00e0ff;
                --text: #000000;
                --border: #000000;
                --radius: 12px;
                --shadow-offset: 4px;
                --shadow-colour: rgba(0, 0, 0, 0.9);
            }

            * {
                box-sizing: border-box;
                margin: 0;
            }

            html,
            body {
                height: 100%;
            }

            body {
                font-family: "Inter", Arial, sans-serif;
                background: var(--bg-color);
                color: var(--text);
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 2rem;
                line-height: 1.4;
            }

            form {
                background: var(--surface-1);
                padding: 2.5rem 3rem;
                border: 3px solid var(--border);
                border-radius: var(--radius);
                box-shadow: var(--shadow-offset) var(--shadow-offset) 0 0
                    var(--shadow-colour);
                max-width: 480px;
                width: 100%;
            }

            h1 {
                font-size: 1.4rem;
                text-transform: uppercase;
                letter-spacing: 1px;
                margin-bottom: 0.25rem;
            }

            p {
                margin-bottom: 1.75rem;
            }

            fieldset {
                border: none;
                padding: 0;
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            label {
                font-weight: 600;
            }

            input[type="file"] {
                width: 100%;
                border: 3px dashed var(--border);
                padding: 1.25rem;
                border-radius: var(--radius);
                background: #ffffff;
                cursor: pointer;
                transition: background 0.15s ease-in-out;
            }

            input[type="file"]:hover {
                background: var(--secondary);
            }

            button {
                appearance: none;
                font-size: 1rem;
                font-weight: 700;
                padding: 0.8rem 1rem;
                border: 3px solid var(--border);
                border-radius: var(--radius);
                background: var(--primary);
                color: var(--text);
                cursor: pointer;
                box-shadow: var(--shadow-offset) var(--shadow-offset) 0 0
                    var(--shadow-colour);
                transition: transform 0.1s ease-in-out;
            }

            button:nth-of-type(2) {
                background: var(--secondary);
            }

            button:active {
                transform: translate(
                    var(--shadow-offset),
                    var(--shadow-offset)
                );
                box-shadow: 0 0 0 0 var(--shadow-colour);
            }

            button:focus-visible,
            input[type="file"]:focus-visible {
                outline: 3px dotted var(--border);
                outline-offset: 3px;
            }

            @media (max-width: 600px) {
                form {
                    padding: 1.75rem 1.5rem;
                }
            }
        </style>
    </head>
    <body>
        <form id="form" action="">
            <h1>PokeRogue Save Converter</h1>
            <fieldset id="input">
                <label for="file">Select .json or .prsv file:</label>
                <input type="file" id="file" accept=".json, .prsv" required />
                <button type="button" id="encryptBtn">
                    Encrypt and Download
                </button>
                <button type="button" id="decryptBtn">
                    Decrypt and Download
                </button>
            </fieldset>
        </form>
        <script src="js/cryptography-js.min.js"></script>
        <script>
            window.onload = function () {
                document
                    .getElementById("decryptBtn")
                    .addEventListener("click", function () {
                        const fileInput = document.getElementById("file");
                        const file = fileInput.files[0];

                        if (!file) {
                            alert("Please select a file.");
                            return;
                        }

                        const reader = new FileReader();
                        reader.onload = function (event) {
                            const fileContent = event.target.result;

                            try {
                                const decrypted = CryptoJS.AES.decrypt(
                                    fileContent,
                                    "x0i2O7WRiANTqPmZ"
                                );
                                const plaintext = decrypted.toString(
                                    CryptoJS.enc.Utf8
                                );

                                const jsonContent = JSON.parse(plaintext);

                                const blob = new Blob(
                                    [JSON.stringify(jsonContent, null, 2)],
                                    { type: "application/json" }
                                );

                                const filename = file.name.startsWith("data")
                                    ? "data_Guest.json"
                                    : file.name.startsWith("sessionData")
                                    ? "sessionData_Guest.json"
                                    : "decrypted_data.json";

                                const downloadLink =
                                    document.createElement("a");
                                downloadLink.href =
                                    window.URL.createObjectURL(blob);
                                downloadLink.download = filename;
                                downloadLink.click();
                            } catch (e) {
                                alert(
                                    "Error: Failed to decrypt or parse JSON."
                                );
                            }
                        };

                        reader.readAsText(file);
                    });

                document
                    .getElementById("encryptBtn")
                    .addEventListener("click", function () {
                        const fileInput = document.getElementById("file");
                        const file = fileInput.files[0];

                        if (!file) {
                            alert("Please select a file.");
                            return;
                        }

                        const reader = new FileReader();
                        reader.onload = function (event) {
                            const fileContent = event.target.result;

                            try {
                                const ciphertext = CryptoJS.AES.encrypt(
                                    CryptoJS.enc.Latin1.parse(fileContent),
                                    "x0i2O7WRiANTqPmZ"
                                ).toString();

                                const blob = new Blob([ciphertext], {
                                    type: "application/octet-stream",
                                });

                                const extension = file.name.endsWith(".json")
                                    ? "prsv"
                                    : "json";
                                const filename = file.name.replace(
                                    /\.[^/.]+$/,
                                    `.${extension}`
                                );

                                const downloadLink =
                                    document.createElement("a");
                                downloadLink.href =
                                    window.URL.createObjectURL(blob);
                                downloadLink.download = filename;
                                downloadLink.click();
                            } catch (e) {
                                alert("Error: Failed to encrypt.");
                            }
                        };

                        reader.readAsBinaryString(file);
                    });
            };
        </script>
    </body>
</html>
